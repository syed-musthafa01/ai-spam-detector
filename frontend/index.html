<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Spam Detector</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root {
  --bg: linear-gradient(135deg, #667eea, #764ba2);
  --card: #ffffff;
  --text: #000;
}

body.dark {
  --bg: #121212;
  --card: #1f1f1f;
  --text: #fff;
}

body {
  background: var(--bg);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: 0.4s;
}

.card {
  background: var(--card);
  color: var(--text);
  width: 100%;
  max-width: 500px;
  animation: slideUp 0.8s ease;
}

textarea {
  resize: none;
}

button:hover {
  transform: scale(1.05);
}

#result {
  opacity: 0;
  transition: 0.4s;
  font-weight: bold;
}

#result.show {
  opacity: 1;
}

.spam {
  color: #dc3545;
  box-shadow: 0 0 15px #dc3545;
  padding: 10px;
  border-radius: 8px;
}

.not-spam {
  color: #198754;
  box-shadow: 0 0 15px #198754;
  padding: 10px;
  border-radius: 8px;
}

canvas {
  position: fixed;
  top: 0;
  left: 0;
  pointer-events: none;
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Mobile */
@media(max-width: 576px) {
  .card { margin: 15px; }
}
</style>
</head>

<body>

<canvas id="confetti"></canvas>

<div class="card shadow-lg p-4">
  <div class="d-flex justify-content-between align-items-center">
    <h3>ðŸ¤– AI Spam Detector</h3>
    <button class="btn btn-sm btn-outline-secondary" onclick="toggleDark()">ðŸŒ™</button>
  </div>

  <textarea id="text" class="form-control my-3" rows="4"
    placeholder="Enter a message..."></textarea>

  <button id="checkBtn" class="btn btn-primary w-100" onclick="checkSpam()">
    Check Spam
  </button>

  <div class="text-center mt-3">
    <div id="loader" class="spinner-border text-primary" style="display:none;"></div>
  </div>

  <p id="result" class="text-center mt-3"></p>
</div>

<!-- Sounds -->
<audio id="successSound" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>
<audio id="errorSound" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3"></audio>

<script>
const result = document.getElementById("result");
const loader = document.getElementById("loader");
const btn = document.getElementById("checkBtn");

async function checkSpam() {
  const message = text.value;
  if (!message) return alert("Please enter a message");

  result.className = "";
  result.classList.remove("show");
  loader.style.display = "inline-block";
  btn.disabled = true;

  try {
    const res = await fetch("https://ai-spam-detector-3zap.onrender.com/predict", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text: message })
    });

    const data = await res.json();
    const pred = data.prediction.toLowerCase();

    result.innerText = `Prediction: ${data.prediction} (Confidence: ${data.spam_confidence}%)`;

    if (pred.includes("not")) {
      result.classList.add("not-spam");
      document.getElementById("successSound").play();
      startConfetti();
    } else {
      result.classList.add("spam");
      document.getElementById("errorSound").play();
    }

    result.classList.add("show");

  } catch {
    result.innerText = "âŒ Error occurred";
    result.classList.add("show");
  }

  loader.style.display = "none";
  btn.disabled = false;
}

/* ðŸŒ™ Dark Mode */
function toggleDark() {
  document.body.classList.toggle("dark");
}

/* ðŸŽ‰ Confetti */
const canvas = document.getElementById("confetti");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

function startConfetti() {
  let pieces = Array.from({length: 150}, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height - canvas.height,
    r: Math.random() * 6 + 4,
    c: `hsl(${Math.random()*360},100%,50%)`,
    s: Math.random() * 3 + 2
  }));

  let frames = 0;
  function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    pieces.forEach(p => {
      ctx.beginPath();
      ctx.fillStyle = p.c;
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fill();
      p.y += p.s;
    });
    frames++;
    if(frames < 120) requestAnimationFrame(draw);
    else ctx.clearRect(0,0,canvas.width,canvas.height);
  }
  draw();
}
</script>

</body>
</html>
